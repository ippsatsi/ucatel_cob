Crear

////////////////////
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [COBRANZA].[SP_LISTAR_USUARIOS_ACTIVOS]
AS
BEGIN
	SELECT USU.USU_CODIGO,
	ROL.ROL_DESCRIPCION,
	USU.USU_DOCUMENTO_IDENTIDAD,
	USU.USU_NOMBRES+' '+USU.USU_APELLIDO_PATERNO+' '+USU.USU_APELLIDO_MATERNO AS USU_NOMBRES,
	CONVERT(VARCHAR,USU.USU_FECHA_REGISTRO,103) AS USU_FECHA_NACIMIENTO,
	CONVERT(VARCHAR,USU.USU_FECHA_BAJA,103) AS USU_DIRECCION_DOMICILIO,
	USU.AST_ANEXO AS USU_CORREO_ELECTRONICO, 
	USU.USU_LOGIN,
	CASE USU.USU_ESTADO_REGISTRO 
		WHEN 'A' THEN 'ACTIVO'
		WHEN 'I' THEN 'INACTIVO'
		ELSE '' END AS USU_ESTADO_REGISTRO
	FROM COBRANZA.GCC_USUARIO USU 
	INNER JOIN COBRANZA.GCC_USUARIO_ROL URO ON URO.USU_CODIGO=USU.USU_CODIGO
	INNER JOIN COBRANZA.GCC_ROL ROL ON ROL.ROL_CODIGO=URO.ROL_CODIGO
	WHERE 
    USU.USU_ESTADO_REGISTRO='A' AND ROL.ROL_CODIGO IN (3,4,5) 
	ORDER BY 1 DESC;
END;

GO
//////////////////////////////////////////////////////////////////

Actualizar

SP_LISTAR_PERIODOS_ACTUALES
//////////////
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [COBRANZA].[SP_LISTAR_PERIODOS_ACTUALES]
AS
BEGIN
	SELECT SCA.SCA_CODIGO,
	PRO.PRV_NOMBRES,
	CAR.CAR_DESCRIPCION,
	SCA.SCA_DESCRIPCION,
	LEFT(CONVERT(varchar, GetDate(),112),6) AS PERIODO_ACTUAL,
	CASE WHEN PER.PER_CODIGO IS NULL THEN 1 ELSE 0 END AS PER_ACTIVO
	FROM COBRANZA.GCC_BASE BAS
	INNER JOIN COBRANZA.GCC_PROVEEDOR PRO ON PRO.PRV_CODIGO=BAS.PRV_CODIGO
	INNER JOIN COBRANZA.GCC_CARTERAS CAR ON CAR.CAR_CODIGO=BAS.CAR_CODIGO
	INNER JOIN COBRANZA.GCC_SUBCARTERAS SCA ON SCA.SCA_CODIGO=BAS.SCA_CODIGO
	LEFT JOIN COBRANZA.GCC_PERIODO_SUBCARTERA PER ON PER.SCA_CODIGO=SCA.SCA_CODIGO AND PER.PER_CODIGO=LEFT(CONVERT(varchar, GetDate(),112),6)
	WHERE BAS.BAS_ESTADO_REGISTRO='A'
	AND PRO.PRV_ESTADO_REGISTRO='A'
	AND CAR.CAR_ESTADO_REGISTRO='A'
	AND SCA.SCA_ESTADO_REGISTRO='A'
    ORDER BY 2 ASC;
END;

GO
//////////////////////////////////////////////////////////////

Actualizar
SP_CARGAR_CARTERAS

////////////
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [COBRANZA].[SP_CARGAR_CARTERAS]
@PRV_CODIGO INT
AS
BEGIN
SELECT CAR_CODIGO,CAR_DESCRIPCION
FROM COBRANZA.GCC_CARTERAS
WHERE CAR_ESTADO_REGISTRO ='A'
AND PRV_CODIGO=@PRV_CODIGO;
END;
GO
/////////////////////////////////////////////

Crear

COBRANZA.SP_CARGAR_SUBCARTERAS
///////////////
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [COBRANZA].[SP_CARGAR_SUBCARTERAS]
@CAR_CODIGO INT
AS
BEGIN
SELECT SCA_CODIGO,SCA_DESCRIPCION
FROM COBRANZA.GCC_SUBCARTERAS
WHERE SCA_ESTADO_REGISTRO ='A'
AND CAR_CODIGO=@CAR_CODIGO;
END;
GO



////////////////////
USE [ucatel_db_gcc]
GO
/****** Object:  StoredProcedure [COBRANZA].[SP_CARGAR_CARTERAS]    Script Date: 05/02/2020 14:46:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [COBRANZA].[SP_LISTAR_USUARIOS_CALL]
AS
BEGIN
SELECT
USU.USU_CODIGO
, USU.USU_NOMBRES+' '+USU.USU_APELLIDO_PATERNO+' '+USU.USU_APELLIDO_MATERNO+' ['+USU.USU_LOGIN+']' AS USU_NOMBRES
FROM
COBRANZA.GCC_USUARIO USU
INNER JOIN COBRANZA.GCC_USUARIO_ROL ROL ON ROL.USU_CODIGO=USU.USU_CODIGO
WHERE
USU.USU_ESTADO_REGISTRO='A'
AND ROL.ROL_CODIGO=4
ORDER BY 2 ASC
END;
///////////////////////////////////////////

Actualizar

COBRANZA.SP_MENU_POR_ROL

///////////////
ALTER PROCEDURE [COBRANZA].[SP_MENU_POR_ROL]
@ROL_CODIGO INT
AS
BEGIN
SELECT PAG_CODIGO,ROL_CODIGO,PAG_URL,PAG_ESTADO,PAG_TITLE,PAG_ES_PADRE,PAG_PADRE,PAG_ICON
FROM COBRANZA.GCC_PAGINA WHERE ROL_CODIGO=@ROL_CODIGO AND PAG_ESTADO='A'
-- INICIO PARA APLICACION PHP 29.01.2020
ORDER BY CASE WHEN PAG_ES_PADRE = 1 THEN PAG_CODIGO*10
				ELSE (PAG_PADRE*10)+PAG_ORDEN END ASC
-- FIN PARA APLICACION PHP 29.01.2020
-- COMENTADO PARA APLICACION PHP 29.01.2020 -- ORDER BY PAG_ORDEN;
END;
/////////////////////////////////////////////

**********TODO
crear js script q valide sesiones y rediriga a pantalla principal cuando la sesion haya caducado
probar agregando telefonos nuevos y ver como aparecen los SG

